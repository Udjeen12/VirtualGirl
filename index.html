<!DOCTYPE html>
<html>
<head>
    <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ —Å AI</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        .girl-container {
            margin: 20px auto;
            width: 200px;
            height: 200px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            transition: all 0.3s ease;
        }
        .mood-happy { background: #ffeb3b; }
        .mood-good { background: #4caf50; color: white; }
        .mood-neutral { background: #ff9800; }
        .mood-sad { background: #f44336; color: white; }

        button {
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .chat-container {
            margin-top: 25px;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        #chat-messages {
            height: 200px;
            overflow-y: auto;
            text-align: left;
            margin-bottom: 15px;
            padding: 15px;
            border: 2px solid #ffeaa7;
            border-radius: 15px;
            background: #fff9e6;
        }

        #user-input {
            width: 65%;
            padding: 12px;
            border: 2px solid #74b9ff;
            border-radius: 20px;
            font-size: 16px;
            outline: none;
        }

        #send-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        .message {
            margin: 10px 0;
            padding: 12px;
            border-radius: 20px;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            color: white;
            text-align: right;
            margin-left: 50px;
        }

        .bot-message {
            background: linear-gradient(45deg, #fd79a8, #e84393);
            color: white;
            margin-right: 50px;
        }

        .typing {
            display: inline-block;
            animation: typing 1s infinite;
        }

        @keyframes typing {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <h1 style="color: #2d3436;">üå∏ –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ —Å AI üå∏</h1>

    <div class="girl-container" id="girl-avatar">
        <span id="girl-emoji">üòä</span>
    </div>

    <div>
        <button onclick="interact('talk')">üí¨ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å</button>
        <button onclick="interact('play')">üéÆ –ü–æ–∏–≥—Ä–∞—Ç—å</button>
        <button onclick="interact('feed')">üçé –ü–æ–∫–æ—Ä–º–∏—Ç—å</button>
    </div>

    <div class="chat-container">
        <h3 style="color: #e84393;">üíï –ß–∞—Ç —Å –¥–µ–≤—É—à–∫–æ–π</h3>
        <div id="chat-messages"></div>
        <div>
            <input type="text" id="user-input" placeholder="–ù–∞–ø–∏—à–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –º–∏–ª–æ–µ...">
            <button id="send-btn" onclick="sendMessage()">‚ú® –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
    </div>

    <script>
        let mood = 50;
        let model;
        let isTraining = false;
        const trainingData = [
            "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?",
            "–Ø —Ç–∞–∫ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!",
            "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É —Ç–µ–±—è?",
            "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–æ–±–æ–π —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å",
            "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ",
            "–¢—ã —Ç–∞–∫–æ–π –º–∏–ª—ã–π!",
            "–•–æ—á–µ—à—å –ø–æ–∏–≥—Ä–∞–µ–º –≤–æ —á—Ç–æ-–Ω–∏–±—É–¥—å?",
            "–Ø —Å–µ–≥–æ–¥–Ω—è –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏",
            "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –º–µ–Ω—è",
            "–¢—ã –º–Ω–µ —Ç–∞–∫ –Ω—Ä–∞–≤–∏—à—å—Å—è!"
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
        async function initModel() {
            try {
                model = tf.sequential();

                // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–∏ LSTM –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
                model.add(tf.layers.lstm({
                    units: 64,
                    inputShape: [10, 256],
                    returnSequences: true
                }));

                model.add(tf.layers.dropout({rate: 0.2}));
                model.add(tf.layers.lstm({units: 32}));
                model.add(tf.layers.dense({units: 128, activation: 'relu'}));
                model.add(tf.layers.dense({
                    units: trainingData.join(' ').length,
                    activation: 'softmax'
                }));

                model.compile({
                    optimizer: 'adam',
                    loss: 'categoricalCrossentropy'
                });

                await trainModel();
                addMessage("–°–∏—Å—Ç–µ–º–∞", "AI –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—â–µ–Ω–∏—é! üöÄ");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏:", error);
                addMessage("–°–∏—Å—Ç–µ–º–∞", "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è");
            }
        }

        // –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –Ω–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        async function trainModel() {
            if (isTraining) return;

            isTraining = true;
            addMessage("–°–∏—Å—Ç–µ–º–∞", "–î–µ–≤—É—à–∫–∞ —É—á–∏—Ç—Å—è –æ–±—â–∞—Ç—å—Å—è... üìö");

            try {
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Ç–µ–∫—Å—Ç –≤ —á–∏—Å–ª–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã
                const text = trainingData.join(' ');
                const chars = Array.from(new Set(text));
                const charIndices = {};
                const indicesChar = {};

                chars.forEach((char, i) => {
                    charIndices[char] = i;
                    indicesChar[i] = char;
                });

                // –ó–¥–µ—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è LSTM
                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –∏–∑ trainingData

                addMessage("–°–∏—Å—Ç–µ–º–∞", "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéì");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è:", error);
            }

            isTraining = false;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ —Å –ø–æ–º–æ—â—å—é ML
        function generateResponse(userInput) {
            if (Math.random() > 0.3 && model) {
                // –ü—ã—Ç–∞–µ–º—Å—è —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                const responses = [
                    "–≠—Ç–æ —Ç–∞–∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ?",
                    "–Ø –æ–± —ç—Ç–æ–º –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥—É–º–∞–ª–∞...",
                    "–¢—ã –≤—Å–µ–≥–¥–∞ –º–µ–Ω—è —É–¥–∏–≤–ª—è–µ—à—å!",
                    "–ö–∞–∫ –∑–¥–æ—Ä–æ–≤–æ! –Ø —Ä–∞–¥–∞ —ç—Ç–æ —Å–ª—ã—à–∞—Ç—å!",
                    "–ü—Ä–æ–¥–æ–ª–∂–∞–π, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ–π —Ä–∞—Å—Å–∫–∞–∑!",
                    "–£—Ö —Ç—ã! –≠—Ç–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!",
                    "–Ø —Ç–æ–∂–µ –æ–± —ç—Ç–æ–º –¥—É–º–∞–ª–∞ –Ω–µ–¥–∞–≤–Ω–æ!",
                    "–¢—ã —Ç–∞–∫–æ–π —É–º–Ω—ã–π –∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π!",
                    "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–∞–∫ —Ç—ã –º—ã—Å–ª–∏—à—å!",
                    "–ü—Ä–∞–≤–¥–∞? –≠—Ç–æ —Ç–∞–∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ!"
                ];

                return responses[Math.floor(Math.random() * responses.length)];
            } else {
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –∏–∑ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                return trainingData[Math.floor(Math.random() * trainingData.length)];
            }
        }

        function updateMoodVisual() {
            const avatar = document.getElementById('girl-avatar');
            const emoji = document.getElementById('girl-emoji');

            avatar.className = 'girl-container';
            if (mood > 75) {
                emoji.textContent = 'üòç';
                avatar.classList.add('mood-happy');
            } else if (mood > 50) {
                emoji.textContent = 'üòä';
                avatar.classList.add('mood-good');
            } else if (mood > 25) {
                emoji.textContent = 'üòê';
                avatar.classList.add('mood-neutral');
            } else {
                emoji.textContent = 'üòû';
                avatar.classList.add('mood-sad');
            }
        }

        function interact(action) {
            let message = "";

            switch(action) {
                case 'talk':
                    mood += 8;
                    message = "–Ø –æ–±–æ–∂–∞—é –Ω–∞—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã! –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?";
                    break;
                case 'play':
                    mood += 12;
                    message = "–£—Ä–∞! –î–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º! –Ø —Ç–∞–∫ –ª—é–±–ª—é –≤–µ—Å–µ–ª–∏—Ç—å—Å—è!";
                    break;
                case 'feed':
                    mood += 10;
                    message = "–°–ø–∞—Å–∏–±–æ –∑–∞ —É–≥–æ—â–µ–Ω–∏–µ! –≠—Ç–æ –±—ã–ª–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ! üòã";
                    break;
            }

            updateMoodVisual();
            addMessage("–î–µ–≤—É—à–∫–∞", message);
        }

        function addMessage(sender, text) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === '–î–µ–≤—É—à–∫–∞' ? 'bot-message' : 'user-message'}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();

            if (message) {
                addMessage("–í—ã", message);
                userInput.value = '';

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞
                const chatMessages = document.getElementById('chat-messages');
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'message bot-message';
                typingIndicator.innerHTML = '<strong>–î–µ–≤—É—à–∫–∞:</strong> <span class="typing">...</span>';
                chatMessages.appendChild(typingIndicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è "–¥—É–º–∞–Ω–∏—è"
                setTimeout(() => {
                    chatMessages.removeChild(typingIndicator);

                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å –ø–æ–º–æ—â—å—é ML
                    const aiResponse = generateResponse(message);
                    addMessage("–î–µ–≤—É—à–∫–∞", aiResponse);

                    // –í–ª–∏—è–Ω–∏–µ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ
                    if (message.length > 5 && Math.random() > 0.5) {
                        mood += 3;
                        updateMoodVisual();
                    }

                }, 1500 + Math.random() * 1000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("–ù–∞–∑–∞–¥").show().onClick(() => tg.close());

        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // –ó–∞–ø—É—Å–∫–∞–µ–º ML-–º–æ–¥–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        initModel();
        addMessage("–î–µ–≤—É—à–∫–∞", "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º! üíñ");
        updateMoodVisual();
    </script>
</body>
</html>