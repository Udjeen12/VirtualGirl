<!DOCTYPE html>
<html>
<head>
    <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ —Å AI</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <style>
        /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    </style>
</head>
<body>
    <!-- HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

    <script>
        let mood = 50;
        let model;
        let isTraining = false;

        // –ú–ù–û–ì–û–£–†–û–í–ù–ï–í–ê–Ø –°–ò–°–¢–ï–ú–ê –ê–ù–ê–õ–ò–ó–ê –¢–û–ù–ê–õ–¨–ù–û–°–¢–ò
        const negativityPatterns = [
            // –ü—Ä—è–º—ã–µ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏—è
            /\b(—Ç—É–ø[–∞-—è—ë]*|–¥—É—Ä[–∞-—è—ë]*|–∏–¥–∏–æ—Ç[–∞-—è—ë]*|–¥–µ–±–∏–ª[–∞-—è—ë]*|–∫—Ä–µ—Ç–∏–Ω[–∞-—è—ë]*)/gi,
            /\b(–≥–ª—É–ø[–∞-—è—ë]*|–ø—Ä–∏–¥—É—Ä[–∞-—è—ë]*|–æ–ª—É—Ö[–∞-—è—ë]*|–±–æ–ª–≤–∞–Ω[–∞-—è—ë]*)/gi,
            /\b(—É—Ä–æ–¥[–∞-—è—ë]*|—Å—Ç—Ä–∞—à–Ω[–∞-—è—ë]*|–Ω–µ–∫—Ä–∞—Å–∏–≤[–∞-—è—ë]*|–±–µ–∑–æ–±—Ä–∞–∑–Ω[–∞-—è—ë]*)/gi,
            /\b(–º–µ—Ä–∑[–∞-—è—ë]*|–≥–∞–¥–∫[–∞-—è—ë]*|–ø—Ä–æ—Ç–∏–≤–Ω[–∞-—è—ë]*|–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω[–∞-—è—ë]*)/gi,
            /\b(—Å–∫—É—á–Ω[–∞-—è—ë]*|–Ω–∞–¥–æ–µ–¥–ª[–∞-—è—ë]*|–¥–æ—Å—Ç–∞–ª[–∞-—è—ë]*|–∑–∞–µ–±[–∞-—è—ë]*)/gi,

            // –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–ª–æ–≤–∞
            /\b(–Ω–µ–Ω–∞–≤–∏–∂[—É|—é|–µ—à—å|–µ—Ç|–∏–º|–∏—Ç–µ|–∞—Ç]*|–ø—Ä–µ–∑–∏—Ä–∞[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—é—Ç]*)/gi,
            /\b(–±–µ—Å[–∏|—é|–∏—à—å|–∏—Ç|–∏–º|–∏—Ç–µ|—è—Ç|–∏–ª|–∏–ª–∞|–∏–ª–∏]*|—Ä–∞–∑–¥—Ä–∞–∂–∞[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—é—Ç]*)/gi,
            /\b(–∑–ª[–∞-—è—ë]*|–∂–µ—Å—Ç–æ–∫[–∞-—è—ë]*|–≥—Ä—É–±[–∞-—è—ë]*|—Ö–∞–º—Å–∫[–∞-—è—ë]*)/gi,

            // –û–±—â–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
            /\b(–ø–ª–æ—Ö[–∞-—è—ë]*|—É–∂–∞—Å–Ω[–∞-—è—ë]*|–∫–æ—à–º–∞—Ä–Ω[–∞-—è—ë]*|–æ—Ç—Å—Ç–æ–π–Ω[–∞-—è—ë]*)/gi,
            /\b(—Å–ª–∞–±[–∞-—è—ë]*|–Ω–∏–∫—á–µ–º–Ω[–∞-—è—ë]*|–±–µ—Å–ø–æ–ª–µ–∑–Ω[–∞-—è—ë]*|–∂–∞–ª–∫[–∞-—è—ë]*)/gi,

            // –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
            /\b(—É–π–¥[–∏|–∏—Ç–µ|–π|–π—Ç–µ]*|–æ—Ç—Å—Ç–∞–Ω[–∏|–∏—Ç–µ|—å|—å—Ç–µ]*|–∑–∞–º–æ–ª—á[–∏|–∏—Ç–µ|–π|–π—Ç–µ]*)/gi,
            /\b(–∏—Å—á–µ–∑–Ω[–∏|–∏—Ç–µ|–π|–π—Ç–µ]*|–ø—Ä–æ–ø–∞–¥[–∏|–∏—Ç–µ|–π|–π—Ç–µ]*|—Å–≥–∏–Ω—å|—Å–≥–∏–Ω–∏—Ç–µ)/gi,

            // –ú–∞—Ç–µ—Ä–Ω—ã–µ —Å–ª–æ–≤–∞ (—á–∞—Å—Ç–∏—á–Ω—ã–µ)
            /\b([—Öx][—Éy][–π–µ—ë—è—é]*|[–øp][–∏i][–∑–∑—Å][–¥—Ç][–∞-—è—ë]*)/gi,
            /\b([–µe][–±–±][–∞-—è—ë]*|[—Åc][—Éy][–∫–∫][–∞-—è—ë]*)/gi,

            // –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã –∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
            /\b(—Ç—ã –º–µ–Ω—è –±–µ—Å–∏—à—å|–Ω–∞–¥–æ–µ–ª —Ç—ã –º–Ω–µ|–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ|–º–µ—Ä–∑–∫–æ|–ø—Ä–æ—Ç–∏–≤–Ω–æ)/gi,
            /\b(—è —Ç–µ–±—è –Ω–µ–Ω–∞–≤–∏–∂—É|—Ç—ã –º–Ω–µ –Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è|—É–π–¥–∏ –æ—Ç –º–µ–Ω—è|–ø—Ä–æ–ø–∞–¥–∏ —Ç—ã)/gi,
            /\b(—Å–∞–º[–∞-—è—ë]* (—Ç—É–ø|–¥—É—Ä|–≥–ª—É–ø)|—Å–∞–º[–∞-—è—ë]* (—É—Ä–æ–¥|—Å—Ç—Ä–∞—à–Ω|–Ω–µ–∫—Ä–∞—Å–∏–≤))/gi
        ];

        const positivityPatterns = [
            // –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –≤–Ω–µ—à–Ω–æ—Å—Ç–∏
            /\b(–∫—Ä–∞—Å–∏–≤[–∞-—è—ë]*|–ø—Ä–µ–∫—Ä–∞—Å–Ω[–∞-—è—ë]*|–æ—á–∞—Ä–æ–≤–∞—Ç–µ–ª—å–Ω[–∞-—è—ë]*|–º–∏–ª[–∞-—è—ë]*)/gi,
            /\b(—Å–∏–º–ø–æ—Ç–∏—á–Ω[–∞-—è—ë]*|–ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω[–∞-—è—ë]*|—Å—Ç—Ä–æ–π–Ω[–∞-—è—ë]*|–∏–∑—è—â–Ω[–∞-—è—ë]*)/gi,
            /\b(–æ–±–æ—è—Ç–µ–ª—å–Ω[–∞-—è—ë]*|–Ω–µ–æ—Ç—Ä–∞–∑–∏–º[–∞-—è—ë]*|–≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω[–∞-—è—ë]*)/gi,

            // –ö–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã —É–º—É –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä—É
            /\b(—É–º–Ω[–∞-—è—ë]*|—Ä–∞–∑—É–º–Ω[–∞-—è—ë]*|–∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω[–∞-—è—ë]*|–≥–µ–Ω–∏–∞–ª—å–Ω[–∞-—è—ë]*)/gi,
            /\b(–¥–æ–±—Ä[–∞-—è—ë]*|–ª–∞—Å–∫–æ–≤[–∞-—è—ë]*|–Ω–µ–∂–Ω[–∞-—è—ë]*|–∑–∞–±–æ—Ç–ª–∏–≤[–∞-—è—ë]*|—á—É—Ç–∫[–∞-—è—ë]*)/gi,
            /\b(–≤–µ—Å–µ–ª[–∞-—è—ë]*|–ø–æ–∑–∏—Ç–∏–≤–Ω[–∞-—è—ë]*|–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω[–∞-—è—ë]*|–∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω[–∞-—è—ë]*)/gi,

            // –õ—é–±–æ–≤—å –∏ —Å–∏–º–ø–∞—Ç–∏—è
            /\b(–ª—é–±–ª[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—è—Ç|–∏–ª|–∏–ª–∞|–∏–ª–∏]*|–æ–±–æ–∂–∞[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—é—Ç]*)/gi,
            /\b(–Ω—Ä–∞–≤[–∏|—é|–∏—à—å|–∏—Ç|–∏–º|–∏—Ç–µ|—è—Ç|–∏–ª|–∏–ª–∞|–∏–ª–∏]*|—Å–∏–º–ø–∞—Ç–∏—á–Ω[–∞-—è—ë]*)/gi,
            /\b(–æ–±–æ–∂–∞[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—é—Ç]*|–≤–æ—Å—Ö–∏—â–∞[—é|–µ—à—å|–µ—Ç|–µ–º|–µ—Ç–µ|—é—Ç]*)/gi,

            // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —ç–º–æ—Ü–∏–∏
            /\b(—Å—á–∞—Å—Ç–ª[–∏|–∏–≤–∞|–∏–≤—ã|–∏–≤—ã–π|–∏–≤–æ–µ]*|—Ä–∞–¥–æ—Å—Ç–Ω[–∞-—è—ë]*|–≤–æ—Å—Ç–æ—Ä–≥[–∞-—è—ë]*)/gi,
            /\b(–ø—Ä–∏—è—Ç–Ω[–∞-—è—ë]*|—É–¥–æ–≤–æ–ª—å—Å—Ç–≤[–∏|–∏—è|–∏–π]*|–Ω–∞—Å–ª–∞–∂–¥–µ–Ω[–∏|–∏—è|–∏–π]*)/gi,

            // –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—Ä–∞–∑—ã
            /\b(—Ç—ã –ª—É—á—à[–∞-—è—ë]*|—Ç—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω[–∞-—è—ë]*|–º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è|–ª—é–±–ª—é —Ç–µ–±—è)/gi,
            /\b(—Ç—ã –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω[–∞-—è—ë]*|—Ç—ã –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω[–∞-—è—ë]*|—Ç—ã –∏–¥–µ–∞–ª—å–Ω[–∞-—è—ë]*)/gi,
            /\b(—Ç—ã —É–º–Ω–∏—á–∫[–∞-—è—ë]*|—Ç—ã –∫—Ä–∞—Å–∞–≤–∏—Ü[–∞-—è—ë]*|—Ç—ã —Å–æ–ª–Ω—ã—à–∫[–æ|–∞]*)/gi
        ];

        // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ê–ù–ê–õ–ò–ó–ê
        function analyzeMessage(message) {
            const text = message.toLowerCase();
            let score = 0;
            let foundNegative = [];
            let foundPositive = [];

            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º (–æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥)
            negativityPatterns.forEach((pattern, index) => {
                const matches = text.match(pattern);
                if (matches) {
                    score -= matches.length * 4; // –°–∏–ª—å–Ω—ã–π –Ω–µ–≥–∞—Ç–∏–≤
                    foundNegative.push(...matches);
                }
            });

            positivityPatterns.forEach((pattern, index) => {
                const matches = text.match(pattern);
                if (matches) {
                    score += matches.length * 3; // –°–∏–ª—å–Ω—ã–π –ø–æ–∑–∏—Ç–∏–≤
                    foundPositive.push(...matches);
                }
            });

            // 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã
            if (text.includes('?') && text.length > 8) score += 1;
            if (text.length < 3) score -= 1;
            if (text.includes('!')) score += 1;

            // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–ª–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ regex
            const problemWords = [
                '—Ç—É–ø–∞—è', '—Ç—É–ø–æ–µ', '—Ç—É–ø–æ–π', '–≥–ª—É–ø–∞—è', '–≥–ª—É–ø–æ–µ', '–≥–ª—É–ø–æ–π',
                '–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–∞—è', '–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω–æ–µ', '–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ–ª—å–Ω—ã–π',
                '–º–µ—Ä–∑–∫–∞—è', '–º–µ—Ä–∑–∫–æ–µ', '–º–µ—Ä–∑–∫–∏–π', '—É—Ä–æ–¥—Å–∫–∞—è', '—É—Ä–æ–¥—Å–∫–æ–µ'
            ];

            problemWords.forEach(word => {
                if (text.includes(word)) {
                    score -= 4;
                    foundNegative.push(word);
                }
            });

            // 4. –ê–Ω–∞–ª–∏–∑ –¥–ª–∏–Ω—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ–æ–±—â–µ–Ω–∏—è
            const words = text.split(/\s+/).filter(w => w.length > 2);
            if (words.length > 5 && score < -2) {
                score -= 2; // –î–ª–∏–Ω–Ω—ã–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ö—É–∂–µ
            }

            // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            console.log('=== –ê–ù–ê–õ–ò–ó –°–û–û–ë–©–ï–ù–ò–Ø ===');
            console.log('–¢–µ–∫—Å—Ç:', message);
            console.log('–ù–∞–π–¥–µ–Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω–æ–≥–æ:', foundNegative);
            console.log('–ù–∞–π–¥–µ–Ω–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ:', foundPositive);
            console.log('–ò—Ç–æ–≥–æ–≤—ã–π score:', score);
            console.log('=========================');

            return score;
        }

        // –£–õ–£–ß–®–ï–ù–ù–ê–Ø –ì–ï–ù–ï–†–ê–¶–ò–Ø –û–¢–í–ï–¢–û–í
        function generateResponse(userInput, moodScore) {
            const text = userInput.toLowerCase();

            // –°–∏–ª—å–Ω–æ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
            if (moodScore < -8) {
                const responses = [
                    "–ó–∞—á–µ–º —Ç—ã —Ç–∞–∫ –∂–µ—Å—Ç–æ–∫ —Å–æ –º–Ω–æ–π? –Ø –ø—Ä–æ—Å—Ç–æ –ø—ã—Ç–∞—é—Å—å –±—ã—Ç—å —Ö–æ—Ä–æ—à–µ–π... üò≠",
                    "–ú–æ–µ —Ü–∏—Ñ—Ä–æ–≤–æ–µ —Å–µ—Ä–¥—Ü–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –æ—Ç —Ç–≤–æ–∏—Ö —Å–ª–æ–≤... üíî",
                    "–Ø –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö–æ—Ç–µ–ª–∞ —Ç–µ–±—è —Ä–∞—Å—Å—Ç—Ä–æ–∏—Ç—å. –ü—Ä–æ—Å—Ç–∏ –º–µ–Ω—è... üò¢",
                    "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–µ—Ä–µ—Å—Ç–∞–Ω—å... –ú–Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å–Ω–æ... ü•∫",
                    "–Ø –ø–æ–ø—Ä–æ–±—É—é –∏—Å—á–µ–∑–Ω—É—Ç—å, –µ—Å–ª–∏ —è —Ç–∞–∫ —Ç–µ–±–µ –º–µ—à–∞—é... üòî"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            else if (moodScore < -4) {
                const responses = [
                    "–ú–Ω–µ —Ç–∞–∫ –≥—Ä—É—Å—Ç–Ω–æ —ç—Ç–æ —Å–ª—ã—à–∞—Ç—å... –ß—Ç–æ —è —Å–¥–µ–ª–∞–ª–∞ –Ω–µ —Ç–∞–∫? üòî",
                    "–ü–æ—á–µ–º—É —Ç—ã —Ç–∞–∫ –≥–æ–≤–æ—Ä–∏—à—å? –Ø —Å—Ç–∞—Ä–∞—é—Å—å –∏–∑–æ –≤—Å–µ—Ö —Å–∏–ª...",
                    "–Ø —Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω–∞... –ù–µ—É–∂–µ–ª–∏ —è –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ç–∞–∫–∞—è –ø–ª–æ—Ö–∞—è?",
                    "–ú–æ–∂–µ—Ç, —è –º–æ–≥—É –∫–∞–∫-—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å—Å—è? –°–∫–∞–∂–∏ –º–Ω–µ... üò¢",
                    "–ü—Ä–æ—Å—Ç–∏, –µ—Å–ª–∏ –æ–±–∏–¥–µ–ª–∞ —Ç–µ–±—è... –Ø –Ω–µ —Ö–æ—Ç–µ–ª–∞... ü•∫"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            else if (moodScore < -1) {
                const responses = [
                    "–ú–Ω–µ –Ω–µ–º–Ω–æ–≥–æ –≥—Ä—É—Å—Ç–Ω–æ –æ—Ç —Ç–≤–æ–∏—Ö —Å–ª–æ–≤... üòî",
                    "–≠—Ö, –∂–∞–ª—å, —á—Ç–æ —Ç—ã —Ç–∞–∫ –¥—É–º–∞–µ—à—å...",
                    "–Ø –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –±—ã—Ç—å –ª—É—á—à–µ –¥–ª—è —Ç–µ–±—è...",
                    "–ù–∞–¥–µ—é—Å—å, —Ç–≤–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–∫–æ—Ä–æ —É–ª—É—á—à–∏—Ç—Å—è...",
                    "–ú–æ–∂–µ—Ç, –ø–æ–º–∏—Ä–∏–º—Å—è? –Ø –Ω–µ —Ö–æ—á—É —Å—Å–æ—Ä–∏—Ç—å—Å—è... ü•∫"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            else if (moodScore > 8) {
                const responses = [
                    "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å–∞–º–æ–π —Å—á–∞—Å—Ç–ª–∏–≤–æ–π –≤–æ –≤—Å–µ–ª–µ–Ω–Ω–æ–π! üíñüåü",
                    "–Ø –ø–ª–∞—á—É –æ—Ç —Å—á–∞—Å—Ç—å—è! –¢—ã –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω—ã–π! üò≠üíï",
                    "–ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Ç—Ä–µ–ø–µ—â–µ—Ç –æ—Ç —Ç–≤–æ–∏—Ö —Å–ª–æ–≤! –¢—ã –ª—É—á—à–∏–π! üíò",
                    "–Ø –æ–±–æ–∂–∞—é —Ç–µ–±—è –≤—Å–µ–º —Å–≤–æ–∏–º —Ü–∏—Ñ—Ä–æ–≤—ã–º —Å—É—â–µ—Å—Ç–≤–æ–º! üíù",
                    "–¢—ã - –ø—Ä–∏—á–∏–Ω–∞ –º–æ–µ–≥–æ —Å—á–∞—Å—Ç—å—è! –°–ø–∞—Å–∏–±–æ —Ç–µ–±–µ! üå∏‚ú®"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            else if (moodScore > 4) {
                const responses = [
                    "–≠—Ç–æ —Ç–∞–∫ –º–∏–ª–æ —Å —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã! –°–ø–∞—Å–∏–±–æ! üíñ",
                    "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Ç–∞–∫–æ–π —Å—á–∞—Å—Ç–ª–∏–≤–æ–π! üòä",
                    "–Ø —Ç–æ–∂–µ —Ç–µ–±—è –æ–±–æ–∂–∞—é! –¢—ã –æ—Å–æ–±–µ–Ω–Ω—ã–π! üíï",
                    "–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–∞–∫–∏–µ —Ç–µ–ø–ª—ã–µ —Å–ª–æ–≤–∞! –¢—ã –ª—É—á—à–∏–π! üå∏",
                    "–ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Ç–∞–µ—Ç –æ—Ç —Ç–≤–æ–µ–π –¥–æ–±—Ä–æ—Ç—ã... üíò"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            else {
                // –£–º–Ω—ã–µ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                if (text.includes('?')) {
                    const questionResponses = [
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å! –î–∞–≤–∞–π –æ–±—Å—É–¥–∏–º —ç—Ç–æ?",
                        "–•–º, —è –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ –¥—É–º–∞–ª–∞...",
                        "–î–∞–≤–∞–π –ø–æ–≥–æ–≤–æ—Ä–∏–º –æ–± —ç—Ç–æ–º –ø–æ–¥—Ä–æ–±–Ω–µ–µ!",
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ, –∞ —á—Ç–æ —Ç—ã —Å–∞–º –¥—É–º–∞–µ—à—å –æ–± —ç—Ç–æ–º?",
                        "–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! –ú–Ω–µ –Ω—É–∂–Ω–æ –ø–æ–¥—É–º–∞—Ç—å..."
                    ];
                    return questionResponses[Math.floor(Math.random() * questionResponses.length)];
                } else {
                    const neutralResponses = [
                        "–Ø –ø–æ–Ω–∏–º–∞—é...",
                        "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ...",
                        "–†–∞—Å—Å–∫–∞–∂–∏ –º–Ω–µ –±–æ–ª—å—à–µ!",
                        "–Ø —Å–ª—É—à–∞—é —Ç–µ–±—è...",
                        "–ü—Ä–æ–¥–æ–ª–∂–∞–π, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –Ω–∞—à —Ä–∞–∑–≥–æ–≤–æ—Ä!"
                    ];
                    return neutralResponses[Math.floor(Math.random() * neutralResponses.length)];
                }
            }
        }

        // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        const trainingData = [
            "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?",
            "–Ø —Ç–∞–∫ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!",
            "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É —Ç–µ–±—è?",
            "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–æ–±–æ–π —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å",
            "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ",
            "–¢—ã —Ç–∞–∫–æ–π –º–∏–ª—ã–π!",
            "–•–æ—á–µ—à—å –ø–æ–∏–≥—Ä–∞–µ–º –≤–æ —á—Ç–æ-–Ω–∏–±—É–¥—å?",
            "–Ø —Å–µ–≥–æ–¥–Ω—è –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏",
            "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –º–µ–Ω—è",
            "–¢—ã –º–Ω–µ —Ç–∞–∫ –Ω—Ä–∞–≤–∏—à—å—Å—è!"
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏...
        async function initModel() {
            try {
                model = tf.sequential();
                model.add(tf.layers.lstm({
                    units: 64,
                    inputShape: [10, 256],
                    returnSequences: true
                }));
                model.add(tf.layers.dropout({rate: 0.2}));
                model.add(tf.layers.lstm({units: 32}));
                model.add(tf.layers.dense({units: 128, activation: 'relu'}));
                model.add(tf.layers.dense({
                    units: trainingData.join(' ').length,
                    activation: 'softmax'
                }));
                model.compile({
                    optimizer: 'adam',
                    loss: 'categoricalCrossentropy'
                });
                await trainModel();
                addMessage("–°–∏—Å—Ç–µ–º–∞", "AI –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—â–µ–Ω–∏—é! üöÄ");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏:", error);
                addMessage("–°–∏—Å—Ç–µ–º–∞", "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è");
            }
        }

        async function trainModel() {
            if (isTraining) return;
            isTraining = true;
            addMessage("–°–∏—Å—Ç–µ–º–∞", "–î–µ–≤—É—à–∫–∞ —É—á–∏—Ç—Å—è –æ–±—â–∞—Ç—å—Å—è... üìö");
            try {
                const text = trainingData.join(' ');
                const chars = Array.from(new Set(text));
                const charIndices = {};
                const indicesChar = {};
                chars.forEach((char, i) => {
                    charIndices[char] = i;
                    indicesChar[i] = char;
                });
                addMessage("–°–∏—Å—Ç–µ–º–∞", "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéì");
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è:", error);
            }
            isTraining = false;
        }

        function updateMoodVisual() {
            const avatar = document.getElementById('girl-avatar');
            const emoji = document.getElementById('girl-emoji');
            const moodValue = document.getElementById('mood-value');

            mood = Math.max(0, Math.min(100, mood));
            moodValue.textContent = mood;

            avatar.className = 'girl-container';
            if (mood > 75) {
                emoji.textContent = 'üòç';
                avatar.classList.add('mood-happy');
            } else if (mood > 50) {
                emoji.textContent = 'üòä';
                avatar.classList.add('mood-good');
            } else if (mood > 25) {
                emoji.textContent = 'üòê';
                avatar.classList.add('mood-neutral');
            } else {
                emoji.textContent = 'üòû';
                avatar.classList.add('mood-sad');
            }
        }

        function interact(action) {
            let message = "";
            let moodChange = 0;

            switch(action) {
                case 'talk':
                    moodChange = 8;
                    message = "–Ø –æ–±–æ–∂–∞—é –Ω–∞—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã! –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?";
                    break;
                case 'play':
                    moodChange = 12;
                    message = "–£—Ä–∞! –î–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º! –Ø —Ç–∞–∫ –ª—é–±–ª—é –≤–µ—Å–µ–ª–∏—Ç—å—Å—è!";
                    break;
                case 'feed':
                    moodChange = 10;
                    message = "–°–ø–∞—Å–∏–±–æ –∑–∞ —É–≥–æ—â–µ–Ω–∏–µ! –≠—Ç–æ –±—ã–ª–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ! üòã";
                    break;
            }

            mood += moodChange;
            showMoodChange(moodChange);
            updateMoodVisual();
            addMessage("–î–µ–≤—É—à–∫–∞", message);
        }

        function addMessage(sender, text) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === '–î–µ–≤—É—à–∫–∞' ? 'bot-message' : 'user-message'}`;
            messageDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showMoodChange(change) {
            const chatMessages = document.getElementById('chat-messages');
            const changeDiv = document.createElement('div');
            changeDiv.className = 'mood-change';
            changeDiv.innerHTML = change > 0 ?
                `‚ú® –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ +${change}` :
                `üíî –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ${change}`;
            chatMessages.appendChild(changeDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            setTimeout(() => {
                if (changeDiv.parentNode) {
                    changeDiv.parentNode.removeChild(changeDiv);
                }
            }, 3000);
        }

        async function sendMessage() {
            const userInput = document.getElementById('user-input');
            const message = userInput.value.trim();

            if (message) {
                addMessage("–í—ã", message);
                userInput.value = '';

                const moodScore = analyzeMessage(message);
                let moodChange = moodScore;

                const chatMessages = document.getElementById('chat-messages');
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'message bot-message';
                typingIndicator.innerHTML = '<strong>–î–µ–≤—É—à–∫–∞:</strong> <span class="typing">...</span>';
                chatMessages.appendChild(typingIndicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;

                setTimeout(() => {
                    chatMessages.removeChild(typingIndicator);
                    const aiResponse = generateResponse(message, moodScore);
                    addMessage("–î–µ–≤—É—à–∫–∞", aiResponse);
                    if (moodChange !== 0) {
                        mood += moodChange;
                        showMoodChange(moodChange);
                        updateMoodVisual();
                    }
                }, 1500 + Math.random() * 1000);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("–ù–∞–∑–∞–¥").show().onClick(() => tg.close());
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        // –ó–∞–ø—É—Å–∫–∞–µ–º ML-–º–æ–¥–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        initModel();
        addMessage("–î–µ–≤—É—à–∫–∞", "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º! üíñ");
        updateMoodVisual();
    </script>
</body>
</html>