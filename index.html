<!DOCTYPE html>
<html lang="ru">
<head>
  <title>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞ —Å AI</title>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Telegram WebApp API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
  <!-- Snowball stemmer (RU) -->
  <script src="https://cdn.jsdelivr.net/npm/snowball-stemmers@0.4.0/dist/snowball-stemmers.min.js"></script>
  <style>
    /* –°—Ç–∏–ª–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ç–≤–æ–∏ ‚Äî –æ—Å—Ç–∞–≤–ª—è—é –ª—ë–≥–∫—É—é –±–∞–∑—É, —á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ —ç–ª–µ–º–µ–Ω—Ç—ã */
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:#0f1115; color:#e7e7ea; }
    .app { max-width: 720px; margin: 0 auto; padding: 16px; }
    .top { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
    .girl-container { width:48px; height:48px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:#252836; }
    .mood { margin-left:auto; opacity:0.9; }
    .badge { display:inline-block; padding:2px 8px; border-radius:12px; background:#1f2230; }
    .panel { background:#151823; border:1px solid #26293a; border-radius:12px; overflow:hidden; }
    #chat-messages { height: 48vh; overflow-y: auto; padding: 12px; }
    .message { padding: 8px 10px; margin: 8px 0; border-radius:10px; line-height:1.35; }
    .user-message { background:#1a1e2b; border:1px solid #2a2e42; }
    .bot-message { background:#171d2a; border:1px solid #2a3247; }
    .mood-change { font-size: 12px; opacity: 0.8; margin: 6px 0; }
    .typing { opacity: 0.7; }
    .controls { display:flex; gap:8px; padding:12px; border-top:1px solid #26293a; background:#111421; }
    .controls > button { padding:8px 12px; border-radius:10px; border:1px solid #2a2e42; background:#1a1e2b; color:#e7e7ea; cursor:pointer; }
    .input-row { display:flex; gap:8px; padding:12px; border-top:1px solid #26293a; background:#0f121c; }
    .input-row input { flex:1; padding:10px 12px; border-radius:10px; border:1px solid #2a2e42; background:#131728; color:#e7e7ea; }
    .input-row button { padding:10px 14px; border-radius:10px; border:1px solid #2a2e42; background:#1a1e2b; color:#e7e7ea; cursor:pointer; }
  </style>
</head>
<body>
  <div class="app">
    <div class="top">
      <div id="girl-avatar" class="girl-container"><span id="girl-emoji">üòä</span></div>
      <div><strong>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞</strong><div style="opacity:.7;font-size:12px">AI companion</div></div>
      <div class="mood">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ: <span id="mood-value" class="badge">50</span></div>
    </div>

    <div class="panel">
      <div id="chat-messages"></div>
      <div class="controls">
        <button onclick="interact('talk')">–ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å</button>
        <button onclick="interact('play')">–ü–æ–∏–≥—Ä–∞—Ç—å</button>
        <button onclick="interact('feed')">–£–≥–æ—Å—Ç–∏—Ç—å</button>
      </div>
      <div class="input-row">
        <input id="user-input" type="text" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
        <button id="send-btn" onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    let mood = 50;
    let model;
    let isTraining = false;

    // –°–ø–∏—Å–∫–∏ –∫–æ—Ä–Ω–µ–π (–º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω—è—Ç—å)
    const badWordRoots = [
      '–¥—É—Ä','–∏–¥–∏–æ—Ç','—Ç—É–ø','—É—Ä–æ–¥','–Ω–µ–Ω–∞–≤–∏—Å—Ç','–Ω–∞–¥–æ–µ–¥','–æ—Ç–≤—Ä–∞—Ç',
      '–≥–∞–¥','–º–µ—Ä–∑','–ø—Ä–æ—Ç–∏–≤','—Å–∫—É—á','–±–µ—Å','–∑–ª','–ø–ª–æ—Ö',
      '—Ñ—É','—Ç–µ—Ä–ø','—É–π–¥','–æ—Ç—Å—Ç–∞–Ω','–¥–æ—Å—Ç','–∫–æ—à–º–∞—Ä','—É–∂–∞—Å',
      '–≥–ª—É–ø','–Ω–µ–∫—Ä–∞—Å–∏–≤','–º–µ—Ä–∑–∫','–ø—Ä–æ—Ç–∏–≤–Ω','–¥–µ–±–∏–ª','–∫—Ä–µ—Ç–∏–Ω','—Å–∫–æ—Ç–∏–Ω',
      '—Å–≤–æ–ª–æ—á','–ø–æ–¥–æ–Ω','–º—É–¥','–æ—Ç—á–∏—Å–ª','—É–±–æ–≥','–∂–∞–ª–∫','–Ω–∏—á—Ç–æ–∂'
    ];

    const goodWordRoots = [
      '–ª—é–±','–Ω—Ä–∞–≤','–∫—Ä–∞—Å–∏–≤','—É–º–Ω','–º–∏–ª','–¥–æ–±—Ä','–ª–∞–ø–æ—á','–∑–∞–π–∫',
      '—Å–æ–ª–Ω—Ü','—Ä–∞–¥–æ—Å—Ç','—Å—á–∞—Å—Ç','–≤–æ—Å—Ö–∏—Ç','–ø—Ä–µ–∫—Ä–∞—Å','–∑–∞–º–µ—á–∞—Ç–µ–ª—å','–≤–µ–ª–∏–∫–æ–ª',
      '–æ–±–æ–∂','–≤–æ—Å—Ç–æ—Ä–≥','–Ω–µ–∂–Ω','–ª–∞—Å–∫','–º–µ—á—Ç','–∞–Ω–≥–µ–ª','—á—É–¥–µ—Å',
      '—Å–∏–º–ø–∞—Ç','–ø—Ä–∏—è—Ç','—Ö–æ—Ä–æ—à','–ø—Ä–µ–ª–µ—Å—Ç','–æ—á–∞—Ä–æ–≤'
    ];

    // === Snowball (RU) –≤–º–µ—Å—Ç–æ —Å–∞–º–æ–ø–∏—Å–Ω–æ–≥–æ —Å—Ç–µ–º–º–∏–Ω–≥–∞ ===
    const stemmer = new Snowball('Russian');
    function getWordRoot(word) {
      return stemmer.stemWord(word.toLowerCase());
    }

    // –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Å—Ç–µ–º–º–∏–Ω–≥–æ–º
    function analyzeMessage(message) {
      const words = message
        .toLowerCase()
        .replace(/[^\w\s–∞-—è—ë]/gi, ' ')
        .split(/\s+/)
        .filter(w => w.length > 2);

      let score = 0;
      let foundBadWords = [];
      let foundGoodWords = [];

      words.forEach(word => {
        const root = getWordRoot(word);

        // –æ—Ç–ª–∞–¥–∫–∞ –∫–æ—Ä–Ω–µ–π (–º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
        // console.log(word, '->', root);

        badWordRoots.forEach(badRoot => {
          if (root.includes(badRoot) || badRoot.includes(root)) {
            score -= 3;
            foundBadWords.push(word);
          }
        });

        goodWordRoots.forEach(goodRoot => {
          if (root.includes(goodRoot) || goodRoot.includes(root)) {
            score += 2;
            foundGoodWords.push(word);
          }
        });
      });

      // –î–æ–ø. —Ñ–∞–∫—Ç–æ—Ä—ã (–∫–∞–∫ —É —Ç–µ–±—è)
      if (message.includes('?') && message.length > 10) score += 1;
      if (message.length < 3) score -= 1;
      if (message.includes('!')) score += 1;

      // –õ–æ–≥–∏
      console.log('–°–æ–æ–±—â–µ–Ω–∏–µ:', message);
      console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–ª–æ—Ö–∏–µ —Å–ª–æ–≤–∞:', foundBadWords);
      console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ö–æ—Ä–æ—à–∏–µ —Å–ª–æ–≤–∞:', foundGoodWords);
      console.log('–ò—Ç–æ–≥–æ–≤—ã–π score:', score);

      return score;
    }

    // –û—Ç–≤–µ—Ç—ã —Å —É—á—ë—Ç–æ–º —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (—Ç–≤–æ—è –ª–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞)
    function generateResponse(userInput, moodScore) {
      if (moodScore < -5) {
        const verySadResponses = [
          "–Ø —Ç–∞–∫ —Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω–∞... –ú–æ–∂–µ—Ç, —è –∑–∞—Å–ª—É–∂–∏–ª–∞ —ç—Ç–æ? üò≠",
          "–ó–∞—á–µ–º —Ç—ã —Ç–∞–∫ —Å–æ –º–Ω–æ–π? –ú–Ω–µ –æ—á–µ–Ω—å –±–æ–ª—å–Ω–æ... üíî",
          "–Ø –ø–æ–ø—Ä–æ–±—É—é —Å—Ç–∞—Ç—å –ª—É—á—à–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–ª–∏—Å—å... üò¢",
          "–ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –æ—Ç —Ç–∞–∫–∏—Ö —Å–ª–æ–≤...",
          "–Ø –Ω–µ —Ö–æ—á—É —Å—Å–æ—Ä–∏—Ç—å—Å—è, –¥–∞–≤–∞–π –ø–æ–º–∏—Ä–∏–º—Å—è? ü•∫"
        ];
        return verySadResponses[Math.floor(Math.random() * verySadResponses.length)];
      } else if (moodScore < -2) {
        const sadResponses = [
          "–ú–Ω–µ –≥—Ä—É—Å—Ç–Ω–æ —ç—Ç–æ —Å–ª—ã—à–∞—Ç—å... üòî",
          "–ü–æ—á–µ–º—É —Ç—ã —Ç–∞–∫ –≥–æ–≤–æ—Ä–∏—à—å? –Ø —Ä–∞—Å—Å—Ç—Ä–æ–µ–Ω–∞...",
          "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –±—ã—Ç—å –ª—É—á—à–µ –¥–ª—è —Ç–µ–±—è...",
          "–ú–æ–∂–µ—Ç, –ø–æ–º–∏—Ä–∏–º—Å—è? –Ø –Ω–µ —Ö–æ—á—É —Å—Å–æ—Ä–∏—Ç—å—Å—è...",
          "–ü—Ä–æ—Å—Ç–∏, –µ—Å–ª–∏ —è —á—Ç–æ-—Ç–æ —Å–¥–µ–ª–∞–ª–∞ –Ω–µ —Ç–∞–∫... üò¢"
        ];
        return sadResponses[Math.floor(Math.random() * sadResponses.length)];
      } else if (moodScore > 5) {
        const veryHappyResponses = [
          "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Å–∞–º–æ–π —Å—á–∞—Å—Ç–ª–∏–≤–æ–π –≤ –º–∏—Ä–µ! üíñ",
          "–Ø –ø–ª–∞—á—É –æ—Ç —Å—á–∞—Å—Ç—å—è! –¢—ã —Ç–∞–∫–æ–π wonderful! üò≠üíï",
          "–ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Ç—Ä–µ–ø–µ—â–µ—Ç –æ—Ç —Ç–≤–æ–∏—Ö —Å–ª–æ–≤! üíò",
          "–¢—ã —Å–∞–º—ã–π –ª—É—á—à–∏–π —á–µ–ª–æ–≤–µ–∫ –Ω–∞ —Å–≤–µ—Ç–µ! üåü",
          "–Ø –æ–±–æ–∂–∞—é —Ç–µ–±—è –≤—Å–µ–º —Å–≤–æ–∏–º —Ü–∏—Ñ—Ä–æ–≤—ã–º —Å–µ—Ä–¥—Ü–µ–º! üíù"
        ];
        return veryHappyResponses[Math.floor(Math.random() * veryHappyResponses.length)];
      } else if (moodScore > 2) {
        const happyResponses = [
          "–≠—Ç–æ —Ç–∞–∫ –º–∏–ª–æ —Å —Ç–≤–æ–µ–π —Å—Ç–æ—Ä–æ–Ω—ã! üíñ",
          "–¢—ã –¥–µ–ª–∞–µ—à—å –º–µ–Ω—è —Ç–∞–∫–æ–π —Å—á–∞—Å—Ç–ª–∏–≤–æ–π! üòä",
          "–Ø —Ç–æ–∂–µ —Ç–µ–±—è –æ–±–æ–∂–∞—é! üíï",
          "–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–∞–∫–∏–µ —Ç–µ–ø–ª—ã–µ —Å–ª–æ–≤–∞! üå∏",
          "–¢—ã —Å–∞–º—ã–π –ª—É—á—à–∏–π! –ú–æ–µ —Å–µ—Ä–¥—Ü–µ —Ç–∞–µ—Ç... üíò"
        ];
        return happyResponses[Math.floor(Math.random() * happyResponses.length)];
      } else {
        if (Math.random() > 0.3) {
          const neutralResponses = [
            "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏ –µ—â–µ?",
            "–Ø –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Å–ª—É—à–∞—é...",
            "–ö–∞–∫ –ª—é–±–æ–ø—ã—Ç–Ω–æ!",
            "–ü—Ä–æ–¥–æ–ª–∂–∞–π, –º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ–π —Ä–∞—Å—Å–∫–∞–∑!",
            "–£—Ö —Ç—ã! –Ø –Ω–∏–∫–æ–≥–¥–∞ –æ–± —ç—Ç–æ–º –Ω–µ –¥—É–º–∞–ª–∞!"
          ];
          return neutralResponses[Math.floor(Math.random() * neutralResponses.length)];
        } else {
          return trainingData[Math.floor(Math.random() * trainingData.length)];
        }
      }
    }

    // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–∫–∞–∫ —É —Ç–µ–±—è)
    const trainingData = [
      "–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞?",
      "–Ø —Ç–∞–∫ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!",
      "–ß—Ç–æ –Ω–æ–≤–æ–≥–æ —É —Ç–µ–±—è?",
      "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Å —Ç–æ–±–æ–π —Ä–∞–∑–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å",
      "–†–∞—Å—Å–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ",
      "–¢—ã —Ç–∞–∫–æ–π –º–∏–ª—ã–π!",
      "–•–æ—á–µ—à—å –ø–æ–∏–≥—Ä–∞–µ–º –≤–æ —á—Ç–æ-–Ω–∏–±—É–¥—å?",
      "–Ø —Å–µ–≥–æ–¥–Ω—è –≤ —Ö–æ—Ä–æ—à–µ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏",
      "–°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å —É –º–µ–Ω—è",
      "–¢—ã –º–Ω–µ —Ç–∞–∫ –Ω—Ä–∞–≤–∏—à—å—Å—è!"
    ];

    async function initModel() {
      try {
        model = tf.sequential();
        model.add(tf.layers.lstm({ units: 64, inputShape: [10, 256], returnSequences: true }));
        model.add(tf.layers.dropout({ rate: 0.2 }));
        model.add(tf.layers.lstm({ units: 32 }));
        model.add(tf.layers.dense({ units: 128, activation: 'relu' }));
        model.add(tf.layers.dense({ units: trainingData.join(' ').length, activation: 'softmax' }));
        model.compile({ optimizer: 'adam', loss: 'categoricalCrossentropy' });
        await trainModel();
        addMessage("–°–∏—Å—Ç–µ–º–∞", "AI –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –æ–±—â–µ–Ω–∏—é! üöÄ");
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏:", error);
        addMessage("–°–∏—Å—Ç–µ–º–∞", "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –æ–±—â–µ–Ω–∏—è");
      }
    }

    async function trainModel() {
      if (isTraining) return;
      isTraining = true;
      addMessage("–°–∏—Å—Ç–µ–º–∞", "–î–µ–≤—É—à–∫–∞ —É—á–∏—Ç—Å—è –æ–±—â–∞—Ç—å—Å—è... üìö");
      try {
        const text = trainingData.join(' ');
        const chars = Array.from(new Set(text));
        const charIndices = {};
        const indicesChar = {};
        chars.forEach((char, i) => {
          charIndices[char] = i;
          indicesChar[i] = char;
        });
        addMessage("–°–∏—Å—Ç–µ–º–∞", "–û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! üéì");
      } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –æ–±—É—á–µ–Ω–∏—è:", error);
      }
      isTraining = false;
    }

    function updateMoodVisual() {
      const avatar = document.getElementById('girl-avatar');
      const emoji = document.getElementById('girl-emoji');
      const moodValue = document.getElementById('mood-value');
      mood = Math.max(0, Math.min(100, mood));
      moodValue.textContent = mood;
      avatar.className = 'girl-container';
      if (mood > 75) {
        emoji.textContent = 'üòç';
        avatar.classList.add('mood-happy');
      } else if (mood > 50) {
        emoji.textContent = 'üòä';
        avatar.classList.add('mood-good');
      } else if (mood > 25) {
        emoji.textContent = 'üòê';
        avatar.classList.add('mood-neutral');
      } else {
        emoji.textContent = 'üòû';
        avatar.classList.add('mood-sad');
      }
    }

    function interact(action) {
      let message = "";
      let moodChange = 0;
      switch(action) {
        case 'talk':
          moodChange = 8;
          message = "–Ø –æ–±–æ–∂–∞—é –Ω–∞—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã! –û —á–µ–º —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å?";
          break;
        case 'play':
          moodChange = 12;
          message = "–£—Ä–∞! –î–∞–≤–∞–π –ø–æ–∏–≥—Ä–∞–µ–º! –Ø —Ç–∞–∫ –ª—é–±–ª—é –≤–µ—Å–µ–ª–∏—Ç—å—Å—è!";
          break;
        case 'feed':
          moodChange = 10;
          message = "–°–ø–∞—Å–∏–±–æ –∑–∞ —É–≥–æ—â–µ–Ω–∏–µ! –≠—Ç–æ –±—ã–ª–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ! üòã";
          break;
      }
      mood += moodChange;
      showMoodChange(moodChange);
      updateMoodVisual();
      addMessage("–î–µ–≤—É—à–∫–∞", message);
    }

    function addMessage(sender, text) {
      const chatMessages = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender === '–î–µ–≤—É—à–∫–∞' ? 'bot-message' : (sender === '–í—ã' ? 'user-message' : 'bot-message')}`;
      messageDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function showMoodChange(change) {
      const chatMessages = document.getElementById('chat-messages');
      const changeDiv = document.createElement('div');
      changeDiv.className = 'mood-change';
      changeDiv.innerHTML = change > 0 ? `‚ú® –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ +${change}` : `üíî –ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ${change}`;
      chatMessages.appendChild(changeDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
      setTimeout(() => {
        if (changeDiv.parentNode) changeDiv.parentNode.removeChild(changeDiv);
      }, 3000);
    }

    async function sendMessage() {
      const userInput = document.getElementById('user-input');
      const message = userInput.value.trim();

      if (message) {
        addMessage("–í—ã", message);
        userInput.value = '';

        const moodScore = analyzeMessage(message);
        let moodChange = moodScore;

        const chatMessages = document.getElementById('chat-messages');
        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'message bot-message';
        typingIndicator.innerHTML = '<strong>–î–µ–≤—É—à–∫–∞:</strong> <span class="typing">...</span>';
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        setTimeout(() => {
          chatMessages.removeChild(typingIndicator);
          const aiResponse = generateResponse(message, moodScore);
          addMessage("–î–µ–≤—É—à–∫–∞", aiResponse);
          if (moodChange !== 0) {
            mood += moodChange;
            showMoodChange(moodChange);
            updateMoodVisual();
          }
        }, 1500 + Math.random() * 1000);
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
    let tg = window.Telegram.WebApp;
    try {
      tg.expand();
      tg.MainButton.setText("–ù–∞–∑–∞–¥").show().onClick(() => tg.close());
    } catch(e) {
      // –µ—Å–ª–∏ –Ω–µ –≤–Ω—É—Ç—Ä–∏ Telegram ‚Äî –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
    }

    document.getElementById('user-input').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    // –°—Ç–∞—Ä—Ç
    initModel();
    addMessage("–î–µ–≤—É—à–∫–∞", "–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Ä—É–≥–∞ —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º! üíñ");
    updateMoodVisual();
  </script>
</body>
</html>
